<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>SOoL Offense Mapping</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    margin: 0;
    padding: 20px;
    background: #ffffff;
    color: #111;
  }
  h1 {
    margin-top: 0;
  }
  .status {
    margin: 12px 0;
    padding: 10px;
    border: 1px solid #ccc;
    background: #f9f9f9;
  }
  .error {
    border-color: #b00020;
    background: #fff0f0;
    color: #700;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 16px;
  }
  th, td {
    border: 1px solid #ccc;
    padding: 8px;
    vertical-align: top;
    text-align: left;
  }
  th {
    background: #f0f0f0;
  }
</style>
</head>

<body>

<h1>SOoL Offense Mapping</h1>

<div id="status" class="status">Initializing…</div>

<table id="table">
  <thead></thead>
  <tbody></tbody>
</table>

<script>
(async function () {
  const status = document.getElementById("status");
  const table = document.getElementById("table");
  const thead = table.querySelector("thead");
  const tbody = table.querySelector("tbody");

  function fail(msg, err) {
    status.classList.add("error");
    status.textContent = msg;
    if (err) console.error(err);
  }

  try {
    status.textContent = "Loading offense_mapping_full.csv…";

    const resp = await fetch("offense_mapping_full.csv", { cache: "no-store" });
    if (!resp.ok) {
      throw new Error("HTTP " + resp.status + " loading CSV");
    }

    const text = await resp.text();
    if (!text.trim()) {
      throw new Error("CSV file is empty");
    }

    const lines = text.split(/\r?\n/).filter(Boolean);
    const headers = lines[0].split(",");

    thead.innerHTML =
      "<tr>" + headers.map(h => `<th>${h}</th>`).join("") + "</tr>";

    for (let i = 1; i < lines.length; i++) {
      const cols = lines[i].split(",");
      const tr = document.createElement("tr");
      cols.forEach(c => {
        const td = document.createElement("td");
        td.textContent = c;
        tr.appendChild(td);
      });
      tbody.appendChild(tr);
    }

    status.textContent = `Loaded ${lines.length - 1} offenses successfully.`;

  } catch (e) {
    fail("Failed to load offense mapping.", e);
  }
})();
</script>

</body>
</html>
